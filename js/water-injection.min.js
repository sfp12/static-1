$(function(){var h="";var d=["","","",""];function e(j,i,k){var l=_.size(h.getData());if(i<l-1){dataString="";_.each(j,function(m,n){dataString+=_.contains(m,",")?'"'+m+'"':m;dataString+=n<_.size(j)-1?",":""});k+=i<l-2?dataString+"\n":dataString}return k}$("#btn").on("click",function(){var l=$("#btn");l.blur();var j="data:text/csv;charset=utf-8,";j=e(d,0,j);_.each(h.getData(),function(n,m){j=e(n,m,j)});var k=encodeURI(j);var i=document.createElement("a");i.setAttribute("href",k);i.setAttribute("download",$("h1").text()+".xls");i.click()});var g=[["班次","时间","压力(Mpa)","","","水表读数(m³)","班注水量(m³)","备注"],["","","干压","油压","套压","上班底数:","",""],["第一班","08:00","","","","","",""],["","10:00","","","","","",""],["","12:00","","","","","",""],["","14:00","","","","","",""],["第二班","16:00","","","","","",""],["","18:00","","","","","",""],["","20:00","","","","","",""],["","22:00","","","","","",""],["第三班","00:00","","","","","",""],["","02:00","","","","","",""],["","04:00","","","","","",""],["","06:00","","","","","",""],["合计日注水量(m³)","","","","","","",""],];var c=document.getElementById("table");var f=function(){h=new Handsontable(c,{data:g,rowHeaders:false,colHeaders:false,mergeCells:[{"row":0,"col":0,"rowspan":2,"colspan":1},{"row":0,"col":1,"rowspan":2,"colspan":1},{"row":0,"col":2,"rowspan":1,"colspan":3},{"row":0,"col":6,"rowspan":2,"colspan":1},{"row":0,"col":7,"rowspan":2,"colspan":1},{"row":2,"col":0,"rowspan":4,"colspan":1},{"row":2,"col":6,"rowspan":4,"colspan":1},{"row":2,"col":7,"rowspan":4,"colspan":1},{"row":6,"col":0,"rowspan":4,"colspan":1},{"row":6,"col":6,"rowspan":4,"colspan":1},{"row":6,"col":7,"rowspan":4,"colspan":1},{"row":10,"col":0,"rowspan":4,"colspan":1},{"row":10,"col":6,"rowspan":4,"colspan":1},{"row":10,"col":7,"rowspan":4,"colspan":1},{"row":14,"col":0,"rowspan":1,"colspan":2},{"row":14,"col":2,"rowspan":1,"colspan":5},],cells:function(m,j,n){var l={};var i=this.instance.toVisualRow(m);var k=this.instance.toVisualColumn(j);if(i<2||k<2){l.readOnly=true}return l},colWidths:function(i){if(i===7){return 200}return 100},})};var a=function(){g[14][2]=data.InjectionAllocation;var i=data.list;i.forEach(function(j,k){g[k*4+2][6]=j.TeamWaterInjection;g[k*4+2][7]=j.Remark;var l=j.Data;l.forEach(function(m,n){g[k*4+n+2][2]=m.TrunkPressure;g[k*4+n+2][3]=m.TubingPressure;g[k*4+n+2][4]=m.CasingPressure;g[k*4+n+2][5]=m.WaterMeterReading})});f()};a();var b=function(){get_data.InjectionAllocation=g[14][2];var i=get_data.list;i.forEach(function(j,k){j.TeamWaterInjection=g[k*4+2][6];j.Remark=g[k*4+2][7];var l=j.Data;l.forEach(function(m,n){m.TrunkPressure=g[k*4+n+2][2];m.TubingPressure=g[k*4+n+2][3];m.CasingPressure=g[k*4+n+2][4];m.WaterMeterReading=g[k*4+n+2][5]})})};setTimeout(function(){b()},3000)});